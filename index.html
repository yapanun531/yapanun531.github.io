<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<script type="module">
    const firebaseConfig = {
        apiKey: process.env.APP_KEY,
        authDomain: process.env.AUTH_DOMAIN,
        projectId: process.env.PROJECT_ID,
        storageBucket: process.env.STORAGE_BUCKET,
        messagingSenderId: process.env.MESSAGING_SENDER_ID,
        appId: process.env.APP_ID
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);


    const dataCollection = db.collection('data');
    dataCollection.get().then((querySnapshot) => {
        let list = [];
        querySnapshot.forEach((doc) => list.push(doc.data().name));

        var nameSelect = document.getElementById("name");
        var inner = "";
        for (var i = 0; i < list.length; i++) {
            inner = inner + '<option value=' + list[i] + '>' + list[i] + '</option>';
        }
        nameSelect.innerHTML = inner;
    })
    const account = document.getElementById('account').value;
    const password = document.getElementById('password').value;
    const name = document.getElementById('name').value;
</script>
<script type="text/javascript">
    Telegram.WebApp.ready();
    Telegram.WebApp.MainButton.setText('註冊').show().onClick(function () {
        const data = JSON.stringify({ account: account, name: name, password: password });
        Telegram.WebApp.sendData(data);
        Telegram.WebApp.close();
    });
</script>

<body>
    <div class="inputBox">
        <select class="form-select" name="name" id="name" required></select>
        <span>請選擇</span>
    </div>
    <div class="inputBox">
        <input type="text" id="account" required>
        <span>帳號:</span>
    </div>
    <div class="inputBox">
        <input type="password" id="floatingPassword" required>
        <span>密碼:</span>
    </div>
</body>
<script type="text/javascript">
    Telegram.WebApp.expand();
</script>

</html>
